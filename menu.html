<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Menu | Bistro Yahya</title>
  <meta name="description" content="View the full Bistro Yahya menu. Pastas, pizzas, burgers, sandwiches, rolls, specialty desserts and fresh juices. Order via WhatsApp or scan QR in-café." />
  <link rel="icon" href="Bistro Yahya.png" />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{ --bg:#fff7f8; --card:#ffffff; --text:#2a2a2a; --muted:#6b6b6b; --accent:#ff7aa2; --accent-2:#f3c6cf; --leaf:#7bb089; --border:#f0dbe0; --max:1120px; --radius:18px; --shadow:0 10px 30px rgba(255,122,162,.18); }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;line-height:1.65}
    h1,h2,h3{font-family:"Playfair Display",serif;margin:0 0 8px}
    a{color:inherit;text-decoration:none}
    .container{max-width:var(--max);margin:0 auto;padding:0 20px}
    header{position:sticky;top:0;background:rgba(255,247,248,.85);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--border);z-index:10}
    .nav{display:flex;align-items:center;justify-content:space-between;padding:14px 0}
    .brand{display:flex;gap:12px;align-items:center}
    .brand img{width:40px;height:40px;border-radius:10px;border:1px solid var(--border)}
    .cta{background:var(--accent);color:#fff;font-weight:700;padding:10px 14px;border-radius:999px;box-shadow:var(--shadow)}
    .cta.disabled{opacity:.55;pointer-events:none;filter:grayscale(20%)}
    main{padding:28px 0}
    .controls{display:flex;gap:12px;flex-wrap:wrap;align-items:center;margin:8px 0 18px}
    .input{background:#fff;border:1px solid var(--border);border-radius:999px;padding:10px 14px;min-width:240px}
    .chip{background:#fff;border:1px solid var(--border);border-radius:999px;padding:8px 12px;cursor:pointer}
    .chip.active{background:#ffe3ec;border-color:#ffd1e2}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:20px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);padding:18px;box-shadow:var(--shadow)}
    .sec{margin-bottom:18px}
    .item{display:grid;grid-template-columns:1fr auto auto;gap:10px;align-items:center;padding:10px 0;border-bottom:1px dashed var(--border)}
    .item:last-child{border-bottom:none}
    .muted{color:var(--muted)}
    .price{font-weight:700}
    .btn{border:1px solid var(--border);background:#fff;border-radius:10px;padding:6px 10px;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .qty{display:inline-flex;align-items:center;gap:8px}
    .sticky{position:sticky;top:82px}
    .summary{display:flex;flex-direction:column;gap:12px}
    .summary h3{margin:0 0 4px}
    .line{display:flex;justify-content:space-between}
    .total{font-weight:800;font-size:18px}
    .note{font-size:12px;color:var(--muted)}
    .tag{display:inline-block;background:var(--leaf);color:#fff;border-radius:999px;padding:2px 8px;font-size:12px;margin-left:8px}
    .ribbon{display:inline-block;background:#fff;border:1px solid var(--border);padding:6px 12px;border-radius:999px}
    footer{border-top:1px solid var(--border);padding:26px 0;color:var(--muted);margin-top:24px}
    @media (max-width: 980px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="./"><img src="Bistro Yahya.png" alt="Bistro Yahya"/><strong style="margin-left:6px">Bistro Yahya</strong></a>
      <div style="display:flex;gap:10px;align-items:center">
        <a class="ribbon" href="./">← Home</a>
        <a class="cta" href="https://wa.me/919611113310?text=Hi%2C%20I%27d%20like%20to%20reserve%20a%20cabin%20at%20Bistro%20Yahya" target="_blank" rel="noopener">Reserve a Cabin</a>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <h1>Menu</h1>
      <p class="muted">Browse our full menu. Add items and send your order via WhatsApp, or scan this page as a QR in-café.</p>

      <div class="controls">
        <input id="search" class="input" placeholder="Search (pizza, brownie, juice...)" />
        <button class="chip active" data-filter="all">All</button>
        <button class="chip" data-filter="Pastas">Pastas</button>
        <button class="chip" data-filter="Pizzas">Pizzas</button>
        <button class="chip" data-filter="Burgers">Burgers</button>
        <button class="chip" data-filter="Sandwiches">Sandwiches</button>
        <button class="chip" data-filter="Rolls">Rolls</button>
        <button class="chip" data-filter="Desserts">Desserts</button>
        <button class="chip" data-filter="Juices">Juices</button>
      </div>

      <div class="grid">
        <div id="menu-root"></div>
        <aside class="card sticky">
          <div class="summary">
            <h3>Your Order</h3>

            <div class="sec">
              <label class="muted" for="custName">Your Name</label>
              <input id="custName" class="input" placeholder="Your name" />
            </div>

            <div class="sec">
              <label class="muted" for="custPhone">Phone</label>
              <input id="custPhone" class="input" placeholder="+91 9XXXXXXXXX" inputmode="tel" />
            </div>

            <div id="order-lines" class="sec"></div>
            <div class="line"><span class="muted">Subtotal</span><span id="subtotal">₹0</span></div>
            <div class="line total"><span>Total</span><span id="total">₹0</span></div>
            <a id="waCheckout" class="cta disabled" target="_blank" rel="noopener">Checkout on WhatsApp</a>
            <div class="note">Payment at café on delivery to cabin / counter. Prices inclusive of taxes (where applicable).</div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">© <span id="year"></span> Bistro Yahya. All rights reserved.</div>
  </footer>

  <script>
    const PHONE = '919611113310';
    const root = document.getElementById('menu-root');
    const orderLines = document.getElementById('order-lines');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');
    const waCheckout = document.getElementById('waCheckout');
    const searchInput = document.getElementById('search');
    const chips = Array.from(document.querySelectorAll('.chip'));
    const custName = document.getElementById('custName');
    const custPhone = document.getElementById('custPhone');
    document.getElementById('year').textContent = new Date().getFullYear();

    let data = { sections: [] };
    let cart = JSON.parse(localStorage.getItem('by_cart')||'{}');
    let activeFilter = 'all';

    // single QR for all; no per-cabin parameter
    const urlCabin = '';

    function saveCart(){ localStorage.setItem('by_cart', JSON.stringify(cart)); }
    function currency(n){ const num = Number(n); return '₹' + (Number.isFinite(num)? num : 0); }

    function sectionMatches(title){
      if(activeFilter==='all') return true;
      const key = activeFilter.toLowerCase();
      return (title||'').toLowerCase().includes(key);
    }

    function itemMatches(item){
      const q = searchInput.value.trim().toLowerCase();
      if(!q) return true;
      return (item.name||'').toLowerCase().includes(q) || (item.desc||'').toLowerCase().includes(q);
    }

    function render(){
      root.innerHTML = '';
      (data.sections||[]).forEach(sec => {
        if(!sectionMatches(sec.title||'')) return;
        const items = (sec.items||[]).filter(itemMatches);
        if(items.length===0) return;

        const card = document.createElement('div');
        card.className = 'card sec';
        card.innerHTML = `<h2>${sec.title||''}</h2>`;

        items.forEach(item => {
          const key = `${sec.title}|${item.name}`;
          const qty = cart[key]?.qty || 0;
          const line = document.createElement('div');
          line.className = 'item';
          line.innerHTML = `
            <div>
              <strong>${item.name||''}</strong>
              ${item.veg? '<span class="tag">Veg</span>':''}
              <div class="muted">${item.desc||''}</div>
            </div>
            <div class="price">${currency(item.price ?? 0)}</div>
            <div class="qty">
              <button class="btn" data-act="dec">−</button>
              <span>${qty}</span>
              <button class="btn" data-act="inc">+</button>
            </div>`;
          line.querySelector('[data-act="dec"]').onclick = ()=>{
            if(qty>0){
              cart[key].qty--;
              if(cart[key].qty<=0) delete cart[key];
              saveCart(); render(); renderSummary();
            }
          };
          line.querySelector('[data-act="inc"]').onclick = ()=>{
            const priceNum = Number(item.price) || 0;
            cart[key] = cart[key]||{name:item.name, price:priceNum};
            cart[key].qty = (cart[key].qty||0)+1;
            saveCart(); render(); renderSummary();
          };
          card.appendChild(line);
        });
        root.appendChild(card);
      });
    }

    function makeWaText(){
      const name = (custName.value||'').trim();
      const phone = (custPhone.value||'').trim();
      const lines = ['Bistro Yahya — New Order'];
      Object.entries(cart).forEach(([, v]) => { lines.push(`• ${v.name} × ${v.qty}`); });
      const total = Object.entries(cart).reduce((s, [, v]) => s + (Number(v.price)||0) * (v.qty||0), 0);
      lines.push(`Total: ₹${total}`);
      lines.push('Cabin/Table (optional): ____');
      lines.push(`Name: ${name || '____'}  Phone: ${phone || '_____'}`);
      return lines.join('\n'); // real newlines; encode once later
    }

    function updateWaLink(){
      const text = encodeURIComponent(makeWaText());
      waCheckout.href = `https://wa.me/${PHONE}?text=${text}`;
      waCheckout.target = '_blank';
      const ready =
        Object.keys(cart).length>0 &&
        (custName.value||'').trim().length>0 &&
        (custPhone.value||'').trim().replace(/\D/g,'').length>=10;
      if(ready){ waCheckout.classList.remove('disabled'); } else { waCheckout.classList.add('disabled'); }
    }

    function renderSummary(){
      orderLines.innerHTML = '';
      let subtotal = 0;
      Object.values(cart).forEach(v => {
        const row = document.createElement('div');
        row.className = 'line';
        const lineTotal = (Number(v.price)||0) * (v.qty||0);
        row.innerHTML = `<span>${v.name} × ${v.qty}</span><span>${currency(lineTotal)}</span>`;
        orderLines.appendChild(row);
        subtotal += lineTotal;
      });
      subtotalEl.textContent = currency(subtotal);
      totalEl.textContent = currency(subtotal);
      updateWaLink();
    }

    async function load(){
      try{
        const res = await fetch('data/menu.json', {cache:'no-store'});
        data = await res.json();
      }catch(e){ data = { sections: [] }; }
      // preload saved name/phone
      custName.value = localStorage.getItem('by_name') || '';
      custPhone.value = localStorage.getItem('by_phone') || '';
      render();
      renderSummary();
      updateWaLink();
    }

    // listeners
    chips.forEach(c=> c.onclick = ()=>{ chips.forEach(x=>x.classList.remove('active')); c.classList.add('active'); activeFilter = c.dataset.filter; render(); });
    searchInput.oninput = ()=> render();
    custName.oninput = ()=>{ localStorage.setItem('by_name', custName.value); updateWaLink(); };
    custPhone.oninput = ()=>{ localStorage.setItem('by_phone', custPhone.value); updateWaLink(); };

    load();
  </script>
</body>
</html>
